services:
  devcontainer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: exchange-devcontainer
    volumes:
      - ../:/workspace:cached
      - cargo-cache:/usr/local/cargo/registry
      - rustup-cache:/usr/local/rustup
    network_mode: service:postgres
    command: sleep infinity
    depends_on:
      postgres:
        condition: service_healthy
      clickhouse:
        condition: service_healthy
    privileged: true
    environment:
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/exchange
      - CLICKHOUSE_URL=http://clickhouse:8123
      - CLICKHOUSE_USER=default
      - CLICKHOUSE_PASSWORD=password

volumes:
  cargo-cache:
  rustup-cache:
